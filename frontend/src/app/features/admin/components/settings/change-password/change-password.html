<form class="password-form" [formGroup]="passwordForm" (ngSubmit)="changePassword()">
  <mat-form-field>
    <mat-label>Current Password</mat-label>
    <input
      matInput
      [type]="hideCurrentPassword() ? 'password' : 'text'"
      formControlName="currentPassword"
      maxlength="4"
      required
      aria-describedby="current-password-error"
    />
    <button
      type="button"
      matIconButton
      matSuffix
      (click)="hideCurrentPassword.set(!hideCurrentPassword())"
      [attr.aria-label]="hideCurrentPassword() ? 'Show password' : 'Hide password'"
      [attr.aria-pressed]="hideCurrentPassword()"
    >
      <mat-icon>{{ hideCurrentPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @if (
      passwordForm.get('currentPassword')?.hasError('required') &&
      passwordForm.get('currentPassword')?.touched
    ) {
      <mat-error id="current-password-error">Current password is required.</mat-error>
    }
  </mat-form-field>

  <mat-form-field>
    <mat-label>New Password</mat-label>
    <input
      matInput
      [type]="hideNewPassword() ? 'password' : 'text'"
      formControlName="newPassword"
      maxlength="4"
      required
      aria-describedby="new-password-hint new-password-pattern-error new-password-same-as-current-error new-password-required-error"
    />
    <button
      type="button"
      matIconButton
      matSuffix
      (click)="hideNewPassword.set(!hideNewPassword())"
      [attr.aria-label]="hideNewPassword() ? 'Show password' : 'Hide password'"
      [attr.aria-pressed]="hideNewPassword()"
    >
      <mat-icon>{{ hideNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    <mat-hint id="new-password-hint">Must be exactly 4 digits.</mat-hint>
    @if (
      passwordForm.get('newPassword')?.hasError('required') &&
      passwordForm.get('newPassword')?.touched
    ) {
      <mat-error id="new-password-required-error">New password is required.</mat-error>
    }
    @if (passwordForm.get('newPassword')?.hasError('pattern')) {
      <mat-error id="new-password-pattern-error">Password must contain only numbers.</mat-error>
    }
    @if (passwordForm.get('newPassword')?.hasError('sameAsCurrent')) {
      <mat-error id="new-password-same-as-current-error"
        >Password must be different from current password.</mat-error
      >
    }
  </mat-form-field>

  <mat-form-field>
    <mat-label>Confirm New Password</mat-label>
    <input
      matInput
      maxlength="4"
      [type]="hideConfirmPassword() ? 'password' : 'text'"
      formControlName="confirmPassword"
      aria-describedby="confirm-password-error"
      required
    />
    <button
      matIconButton
      type="button"
      matSuffix
      (click)="hideConfirmPassword.set(!hideConfirmPassword())"
      [attr.aria-label]="'Hide password'"
      [attr.aria-pressed]="hideConfirmPassword()"
    >
      <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
    </button>
    @if (
      passwordForm.get('confirmPassword')?.hasError('mismatch') &&
      passwordForm.get('confirmPassword')?.touched
    ) {
      <mat-error id="confirm-password-error">Passwords do not match.</mat-error>
    }
  </mat-form-field>

  <button matButton="filled" type="submit" [disabled]="passwordForm.invalid">
    Change Password
  </button>
</form>
